<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>四则运算百题斩</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>

<body>
    <ul class="layui-nav layui-bg-blue">
        <li class="layui-nav-item"><a style="font-size: 20px;color: #fff;">四则运算百题斩</a></li>
    </ul>
    <div class="layui-container">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
            <legend>四则运算</legend>
        </fieldset>
        <table class="layui-hide" id="test" lay-filter="do"></table>

        <script type="text/html" id="toolbarDemo">
          <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="reDo">重新选题</button>
            <button class="layui-btn layui-btn-sm" lay-event="submit">交卷</button>
            <button class="layui-btn layui-btn-sm" lay-event="switch">模式切换</button>
          </div>
        </script>

        <script type="text/html" id="barDemo">
              <a class="layui-btn layui-btn-xs" lay-event="info">提示</a>
              <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">重做</a>
        </script>
    </div>
    <script src="./layui/layui.js" charset="utf-8"></script>
    <script src="formula.js" charset="utf-8"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->

    <script>
        layui.use('table', function () {
            var model = 0
            /* 模式切换：0为考试模式；1为练习模式 */
            var table = layui.table
                , $ = layui.$;
            data = get_formula()

            console.log(formula);
            var TD = table.render({
                elem: '#test'
                , data: alu(100)
                , loading: true
                , even: true
                , defaultToolbar: ['print', 'exports']
                , toolbar: '#toolbarDemo'
                , page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    //,curr: 5 //设定初始在第 5 页
                    , groups: 1 //只显示 1 个连续页码
                    , first: false //不显示首页
                    , last: false //不显示尾页

                }
                , cols: [[
                    { field: 'id', width: 80, title: '题号' }
                    , { field: 'title', width: 490, title: '题目' }
                    , { field: 'diff', width: 300, title: '难度' }
                    , { field: 'ans', width: 150, title: '答案', edit: 'text' }
                    , { fixed: 'right', width: 115, toolbar: '#barDemo', title: '操作' }
                ]]

            });
            table.on('toolbar(do)', function (obj) {
                if (obj.event === 'reDo') {
                    // layer.msg("测试");
                    TD = table.render({
                        elem: '#test'
                        , data: alu(100)
                        , loading: true
                        , even: true
                        , defaultToolbar: ['print', 'exports']
                        , toolbar: '#toolbarDemo'
                        , page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                            layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                            //,curr: 5 //设定初始在第 5 页
                            , groups: 1 //只显示 1 个连续页码
                            , first: false //不显示首页
                            , last: false //不显示尾页

                        }
                        , cols: [[
                            { field: 'id', width: 80, title: '题号' }
                            , { field: 'title', width: 490, title: '题目' }
                            , { field: 'diff', width: 300, title: '难度' }
                            , { field: 'ans', width: 150, title: '答案', edit: 'text' }
                            , { fixed: 'right', width: 115, toolbar: '#barDemo', title: '操作' }
                        ]]

                    });
                }
                else if (obj.event == "submit") {
                    var sum = 0;
                    var right = 0;
                    var erro_info = new Array()
                    var str_html = ""
                    //+ '</table>'
                    for (var i = 0; i < TD.config.data.length; i++) {
                        if (TD.config.data[i].ans != undefined && TD.config.data[i].ans != "") {
                            sum++;
                            if (TD.config.data[i].ans == TD.config.data[i].res) {
                                right++
                            }
                            else {
                                console.log(TD.config.data[i])
                                str_html += '<tr>'
                                    + '<td>' + TD.config.data[i].id + '</td>'
                                    + '<td>' + TD.config.data[i].title + '</td>'
                                    + '<td>' + TD.config.data[i].ans + '</td>'
                                    + '<td>' + TD.config.data[i].res + '</td>'
                                    + '</tr>'
                            }
                        }
                    }
                    var show_html = '<div>'
                        + '<fieldset class="layui-elem-field layui-field-title layui-box" style="margin-top: 20px;">'
                        + '<legend>得分：' + right + '</legend>'
                        + '</fieldset>'
                        + '<div class="layui-row">'
                        + '<div class="layui-col-sm3">'
                        + '<div style="text-align: center"><i class="layui-icon" style="color: #1E9FFF;">&#xe67a;</i>  总共：100题</div>'
                        + '</div >'
                        + '<div class="layui-col-sm3">'
                        + '<div style="text-align: center"><i class="layui-icon" style="color: #1E9FFF;">&#xe6af;</i>  做了：' + sum + '题</div>'
                        + '</div>'
                        + '<div class="layui-col-sm3">'
                        + '<div style="text-align: center"><i class="layui-icon" style="color: #1E9FFF;">&#xe664;</i>  做对：' + right + '题</div>'
                        + '</div>'
                        + '<div class="layui-col-sm3">'
                        + '<div style="text-align: center"><i class="layui-icon" style="color: #1E9FFF;">&#xe69c;</i>  做错：' + (sum - right) + '题</div>'
                        + '</div>'
                        + '</div >'
                        + '<table class="layui-table">'
                        + '<colgroup>'
                        + '<col width="50">'
                        + '<col width="200">'
                        + '<col width="100">'
                        + '<col width="100">'
                        + '</colgroup>'
                        + '<thead>'
                        + '<tr>'
                        + '<th>题号</th>'
                        + '<th>题目</th>'
                        + '<th>你的答案</th>'
                        + '<th>正确答案</th>'
                        + '</tr>'
                        + '</thead>'
                        + '<tbody>'
                        + str_html
                        + '</tbody>'
                        + '</table>'
                        + '</div>'
                    if (sum == 0) {
                        layer.alert('你交白卷了，系统不会给分', {
                            icon: 5,
                            skin: 'layer-ext-moon'
                        })
                    }
                    else if (sum != 100) {
                        var confirm = layer.confirm('你还有 ' + (100 - sum) + ' 题没完成', {
                            btn: ['确认提交？', '返回继续做'] //按钮
                        }, function () {
                            layer.close(confirm)
                            layer.open({
                                type: 1,
                                anim: 2,
                                skin: 'layui-layer-lan',
                                area: ['600px', '360px'],
                                content: show_html
                            });
                        }, function () {
                            layer.msg('继续加油哦！');
                        });
                    }

                    // console.log(TD)
                    // console.log(TD.config.data)
                    // console.log(TD.config.data.ans.length)
                }
                else if (obj.event == "switch") {
                    if (model == 0) {
                        layer.alert('切换为练习模式，\n练习模式下你可以随时查看答案')
                        model = 1
                    }
                    else if ((model == 1)){
                        layer.alert('切换为考试模式，\n考试模式下你不可以查看答案')
                        model = 0
                    }
                    
                }
            });
            table.on('tool(do)', function (obj) {
                var data = obj.data;
                console.log(obj)
                if (obj.event === 'del') {
                    layer.confirm('确认重置吗', function (index) {
                        //console.log(obj)
                        obj.update({
                            ans: ""
                        });
                        layer.close(index);
                    });
                } else if (obj.event === 'info') {
                    if (model == 0) {
                        layer.alert('当前为考试模式，你不可以查看答案')
                    }
                    else {
                        layer.alert('答案是:' + data.res, {
                            skin: 'layui-layer-lan'
                            , closeBtn: 0
                            , anim: 4 //动画类型
                        });
                    }

                }
            });
        });
    </script>

</body>

</html>